<html>

<head>
    <title>Is She Mad?</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles/styles.css">
    <link href="https://fonts.googleapis.com/css?family=Rock+Salt" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
        crossorigin="anonymous">



</head>


<body>
    <div class="navbar fixed-top bg-light" id="navbar">
        <h2 id="navTitle">Is She Mad?</h2>
        <a href="#inputDiv" class="navlinks">Form</a>
        <a href="#suggestedgift" class="navlinks">Gifts</a>
        <a href="#viewByAuthor" class="navlinks">Search By Author</a>
        <a href="#topTen" class="navlinks">Top Ten</a>
    </div>
    <div class="jumbotron jumbotron-fluid w-100; text-center">


        <h1 id="header-text">Is She Mad?</h1>
        <div class="w-100" id="topLinks">
            <ul class="list-inline">
                <li class="list-inline-item">
                    <a href="#inputDiv">Form</a>
                </li>
                <li class="list-inline-item">
                    <a href="#suggestedgift">Gifts</a>
                </li>
                <li class="list-inline-item">
                    <a href="#viewByAuthor">Search by Author</a>
                </li>
                <li class="list-inline-item">
                    <a href="#topTen">Top Ten</a>
                </li>
            </ul>
            <!-- <i class="fas fa-angle-down"></i> -->


        </div>
    </div>

    <div id="main" class="bg-light container">

        <div id="inputDiv" class="bg-light text-dark p-2 border border-light mt-5">
            <h1 class="inputShow">Fill out the fields below</h1>
            <div class="form-group m-3 inputShow">
                <label for="author">Author Name</label>
                <input type="text" id="authorName" name="author" class="form-control mb-3">
                <textarea name="message" id="inputText" class="form-control" cols="5" rows="4" placeholder="What did she say?"></textarea>
                <button type="submit" class="btn btn-lg bg-success mt-2 text-light" id="submit">Submit</button>
            </div>
            <h1 class="resultsShow">Your results were
                <span id="perc"></span>!!</h1>
            <h2 id="rank"></h2>
        </div>

        <div id="suggestedgift" class="bg-dark p-2 text-light container-fluid p-5 mt-5">
            <div class="row">
                <h1>Maybe you should get her something...</h1>
                <div id="item-image" class="col-md-5 mt-5 ml-1">
                    Image placeholder
                </div>
                <div id="gift-description" class="text-center col-md-6 mt-5">
                    <h2 class="border border-light bg-dark p-3" id="itemTitle">Fake Amazon item</h2>
                    <h2 id="desc">Bacon ipsum dolor amet meatball biltong jowl, filet mignon venison salami tenderloin tail. Buffalo cupim
                        burgdoggen, picanha ham sirloin drumstick tail.Bacon ipsum dolor amet meatball biltong jowl, filet
                        mignon venison salami tenderloin tail. Buffalo cupim burgdoggen, picanha ham sirloin drumstick tail.</h2>
                    <a id="button" href="http://google.com" class="btn-lg bg-warning text-light p-2" role="button" target="blank">Buy Now!</a>
                </div>

            </div>
        </div>
        <div id="viewByAuthor" class="bg-light p-2 text-dark">
            <h1>View other author's results!</h1>
            <div class="form-group m-3 ">
                <label for="authorSearch">Author Name</label>
                <input type="text" id="authorSearch" name="authorSearch" class="form-control mb-3">
                <button type="submit" class="btn btn-lg bg-success mt-2 text-light" id="submitAuthor">Submit</button>
            </div>
        <div id="authorTexts"></div>
            
        </div>
        <div id="topTen" class="bg-light p-2 col-md-12 row mt-5">
            <div class="col-md-12">
                <h1>Top Ten</h1>
            </div>
            
            <div class="top-ten-list">
                
            </div> 
          
        </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script>

function scrollFunction() {
    if (document.body.scrollTop > 500) {
        document.getElementById("navbar").style.top = "0";
    } else {
        document.getElementById("navbar").style.top = "-100px";
    }
};


$(document).on('scroll', function() {
    scrollFunction();
});

//         function scrollFunction() {
//     if ($(document).scrollTop() < 500) {
//      document.getElementById("navbar").style.top = "0";
//     } else {
//     document.getElementById("navbar").style.top = "-100px";
//   }
// }
        $(window).scroll(function () {
            if ($(document).scrollTop() < 500) {
                $('.navbar').addClass('unscrolled-bar');
            } else {
                $('.navbar').removeClass('unscrolled-bar');
            }
        });
        $(function(){
        $("#suggested-gift").hide();
        $.get("/api/topten", function(data){
            console.log(data);
            var topTen;
            if(data.length<10){
                topTen=data.length
            }else{topTen=10};
            for (var i = 0; i < topTen; i++) {
                var ttdiv = $("<div class=card>");
                var p = $("<div class=card-title>").html("#" + (i+1));
                var textDiv = $("<div class=card-body>").html(data[i].text);
                var authorDiv = $("<div class=card-footer bg-light text-right class=bottom>").html(data[i].user);
                ttdiv.append(p).append(textDiv).append(authorDiv);
                $("#topTen").append(ttdiv);
            }
        });
    })
    $('#submit').on('click',function(){
        //event.preventDefault();
    console.log('clicked')
    var newTweet = {
        author:$("#authorName").val().trim(),
        text: $("#inputText").val().trim(),
    }

    $.post("/api/new", newTweet).then(function(result){
        var id=result.id;
    
        $('.inputShow').hide();
        $('.resultsShow').show();
        
        $('#perc').text(result.score);
        if (result.score < 40) {
            $("#suggested-gift").show();
            $("#itemTitle").html("Bouquet Of Flowers");
            $("#desc").html("What woman doesn't like flowers. Its a timeless gift that will show her that you are truely sorry for whatever transgression you have commited.");
            $("#item-image").html("<img src='./images/Flowers.jpg' class='gift'>");
            $("#button").attr("href", "https://www.1800flowers.com/");
        } else if (result.score >= 40 && result.score < 55) {
            $("#suggested-gift").show();
            $("#itemTitle").html("Chocolate");
            $("#desc").html("Chocolate says I'm sorry so much better than words.");
            $("#item-image").html("<img src='./images/chocolate.jpg' class='gift'>");
            $("#button").attr("href", "https://www.godiva.com/");
        } else if (result.score >= 55 && result.score < 65) {
            $("#suggested-gift").show();
            $("#itemTitle").html("Roses");
            $("#desc").html("Its now time to break out the big guns. whatever you have done, you probably will want to stop doing it.");
            $("#item-image").html("<img src='./images/roses.jpg' class='gift'>");
            $("#button").attr("href", "https://www.1800flowers.com/roses");
        } else if (result.score >= 65 && result.score < 75) {
            $("#suggested-gift").show();
            $("#itemTitle").html("Puppy");
            $("#desc").html("This gift is almost unfair. Who can say no to a cute puppy, its guaranteed to melt her heart.");
            $("#item-image").html("<img src='./images/puppy.jpg' class='gift'>");
            $("#button").attr("href", "www.aspca.org/adoptâ€Ž");
        } else if (result.score >= 75 && result.score < 85) {
            $("#suggested-gift").show();
            $("#itemTitle").html("Jewelry");
            $("#desc").html("She seems like she is starting to get tired of your nonsense. Small jewelry is always a nice choice to bring you back into her good graces.");
            $("#item-image").html("<img src='./images/jewelry.jpg' class='gift'>");
            $("#button").attr("href", "https://www.bluenile.com/jewelry?track=NavDrawJewelry");
        } else if (result.score >= 85 && result.score < 95) {
            $("#suggested-gift").show();
            $("#itemTitle").html("Diamonds");
            $("#desc").html('Dude, she seems super angry. Diamonds are a "girls best friend". Always a classy choice but they can be expensive. but she deserves it for putting up with your dumb ass.');
            $("#item-image").html("<img src='./images/diamonds.jpg' class='gift'>");
            $("#button").attr("href", "https://www.bluenile.com/diamond-jewelry");
        } else if (result.score >= 95) {
            $("#suggested-gift").show();
            $("#itemTitle").html("A New Car");
            $("#desc").html('Brah, you probably do not want to go home. She is beyond pissed off. The only thing that might save you is buying her a new car.');
            $("#item-image").html("<img src='./images/new-car.jpg' class='gift'>");
            $("#button").attr("href", "https://www.cars.com/");
        }
        $.get("/api/topten", function(data){
            console.log(data);
            var rank= data.findIndex(x => x.id==id);
            rank+=1;
            console.log(rank);
            $('#rank').text("That text ranked #"+rank+"!");

            // for (i = 0; i < 10; i++){
            //     $(".top-ten-list").append(data[i].user + "&nbsp;&nbsp;&nbsp;" + data[i].score);
            //     $(".top-ten-list").append("<br>");               
            // }
            
        });
    });
    
});

$('#submitAuthor').on('click',function(){
        //event.preventDefault();
    console.log('author query clicked')
    var authorQuery = "/api/author/"+$("#authorSearch").val().trim();
    console.log(authorQuery);
    
    $.get(authorQuery, function(data){
            console.log("get request returned");
            console.log(data);
            console.log(data.length);
            for(var i=0; i<data.length; i++){
                console.log(" it should be displaying this" +data[i].text);
                // $("#authorTexts").append(data[i].text);
                var atdiv = $("<div class=card>");
                var authorDiv = $("<div class=card-footer bg-light text-right class=bottom>").html(data[i].score + "%");
                var textDiv = $("<div class=card-body>").html(data[i].text);
                atdiv.append(textDiv).append(authorDiv);
                $("#authorTexts").append(atdiv);
            }
        $.get("/api/rank", function(data){
            console.log(data);
    
        });
    });
});
    
    </script>

</body>

</html>